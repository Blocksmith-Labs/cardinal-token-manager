{"version":3,"file":"accounts.js","sourceRoot":"","sources":["../../../../src/programs/claimApprover/accounts.ts"],"names":[],"mappings":"AAAA,OAAO,EACL,cAAc,EACd,kBAAkB,EAClB,OAAO,GACR,MAAM,uBAAuB,CAAC;AAC/B,OAAO,EAAE,YAAY,EAAE,MAAM,yBAAyB,CAAC;AAEvD,OAAO,EAAE,OAAO,EAAE,MAAM,iBAAiB,CAAC;AAO1C,OAAO,EAAE,sBAAsB,EAAE,kBAAkB,EAAE,MAAM,aAAa,CAAC;AACzE,OAAO,EAAE,wBAAwB,EAAE,MAAM,OAAO,CAAC;AAEjD,MAAM,CAAC,MAAM,gBAAgB,GAAG,KAAK,EACnC,UAAsB,EACtB,cAAyB,EACoB,EAAE;IAC/C,MAAM,QAAQ,GAAG,IAAI,cAAc,CACjC,UAAU,EACV,IAAI,YAAY,CAAC,OAAO,CAAC,QAAQ,EAAE,CAAC,EACpC,EAAE,CACH,CAAC;IACF,MAAM,oBAAoB,GAAG,IAAI,OAAO,CACtC,kBAAkB,EAClB,sBAAsB,EACtB,QAAQ,CACT,CAAC;IAEF,MAAM,CAAC,eAAe,CAAC,GAAG,MAAM,wBAAwB,CAAC,cAAc,CAAC,CAAC;IAEzE,MAAM,MAAM,GAAG,MAAM,oBAAoB,CAAC,OAAO,CAAC,iBAAiB,CAAC,KAAK,CACvE,eAAe,CAChB,CAAC;IACF,OAAO;QACL,MAAM;QACN,MAAM,EAAE,eAAe;KACxB,CAAC;AACJ,CAAC,CAAC;AAEF,MAAM,CAAC,MAAM,iBAAiB,GAAG,KAAK,EACpC,UAAsB,EACtB,gBAA6B,EACkB,EAAE;IACjD,MAAM,QAAQ,GAAG,IAAI,cAAc,CACjC,UAAU,EACV,IAAI,YAAY,CAAC,OAAO,CAAC,QAAQ,EAAE,CAAC,EACpC,EAAE,CACH,CAAC;IACF,MAAM,oBAAoB,GAAG,IAAI,OAAO,CACtC,kBAAkB,EAClB,sBAAsB,EACtB,QAAQ,CACT,CAAC;IAEF,IAAI,cAAc,GAAqC,EAAE,CAAC;IAC1D,IAAI;QACF,cAAc;YACZ,CAAC,MAAM,oBAAoB,CAAC,OAAO,CAAC,iBAAiB,CAAC,aAAa,CACjE,gBAAgB,CACjB,CAAqC,CAAC;KAC1C;IAAC,OAAO,CAAC,EAAE;QACV,OAAO,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC;KAChB;IACD,OAAO,cAAc,CAAC,GAAG,CAAC,CAAC,EAAE,EAAE,CAAC,EAAE,EAAE,CAAC,CAAC;QACpC,MAAM,EAAE,EAAG;QACX,MAAM,EAAE,gBAAgB,CAAC,CAAC,CAAE;KAC7B,CAAC,CAAC,CAAC;AACN,CAAC,CAAC;AAEF,MAAM,CAAC,MAAM,oBAAoB,GAAG,KAAK,EACvC,UAAsB,EACyB,EAAE;IACjD,MAAM,eAAe,GAAG,MAAM,UAAU,CAAC,kBAAkB,CACzD,sBAAsB,CACvB,CAAC;IAEF,MAAM,cAAc,GAAyC,EAAE,CAAC;IAChE,MAAM,KAAK,GAAG,IAAI,kBAAkB,CAAC,kBAAkB,CAAC,CAAC;IACzD,eAAe,CAAC,OAAO,CAAC,CAAC,OAAO,EAAE,EAAE;QAClC,IAAI;YACF,MAAM,iBAAiB,GAA0B,KAAK,CAAC,MAAM,CAC3D,mBAAmB,EACnB,OAAO,CAAC,OAAO,CAAC,IAAI,CACrB,CAAC;YACF,cAAc,CAAC,IAAI,CAAC;gBAClB,GAAG,OAAO;gBACV,MAAM,EAAE,iBAAiB;aAC1B,CAAC,CAAC;SACJ;QAAC,OAAO,CAAC,EAAE;YACV,OAAO,CAAC,GAAG,CAAC,sCAAsC,CAAC,CAAC;SACrD;IACH,CAAC,CAAC,CAAC;IACH,OAAO,cAAc,CAAC;AACxB,CAAC,CAAC","sourcesContent":["import {\n  AnchorProvider,\n  BorshAccountsCoder,\n  Program,\n} from \"@project-serum/anchor\";\nimport { SignerWallet } from \"@saberhq/solana-contrib\";\nimport type { Connection, PublicKey } from \"@solana/web3.js\";\nimport { Keypair } from \"@solana/web3.js\";\n\nimport type { AccountData } from \"../../utils\";\nimport type {\n  CLAIM_APPROVER_PROGRAM,\n  PaidClaimApproverData,\n} from \"./constants\";\nimport { CLAIM_APPROVER_ADDRESS, CLAIM_APPROVER_IDL } from \"./constants\";\nimport { findClaimApproverAddress } from \"./pda\";\n\nexport const getClaimApprover = async (\n  connection: Connection,\n  tokenManagerId: PublicKey\n): Promise<AccountData<PaidClaimApproverData>> => {\n  const provider = new AnchorProvider(\n    connection,\n    new SignerWallet(Keypair.generate()),\n    {}\n  );\n  const claimApproverProgram = new Program<CLAIM_APPROVER_PROGRAM>(\n    CLAIM_APPROVER_IDL,\n    CLAIM_APPROVER_ADDRESS,\n    provider\n  );\n\n  const [claimApproverId] = await findClaimApproverAddress(tokenManagerId);\n\n  const parsed = await claimApproverProgram.account.paidClaimApprover.fetch(\n    claimApproverId\n  );\n  return {\n    parsed,\n    pubkey: claimApproverId,\n  };\n};\n\nexport const getClaimApprovers = async (\n  connection: Connection,\n  claimApproverIds: PublicKey[]\n): Promise<AccountData<PaidClaimApproverData>[]> => {\n  const provider = new AnchorProvider(\n    connection,\n    new SignerWallet(Keypair.generate()),\n    {}\n  );\n  const claimApproverProgram = new Program<CLAIM_APPROVER_PROGRAM>(\n    CLAIM_APPROVER_IDL,\n    CLAIM_APPROVER_ADDRESS,\n    provider\n  );\n\n  let claimApprovers: (PaidClaimApproverData | null)[] = [];\n  try {\n    claimApprovers =\n      (await claimApproverProgram.account.paidClaimApprover.fetchMultiple(\n        claimApproverIds\n      )) as (PaidClaimApproverData | null)[];\n  } catch (e) {\n    console.log(e);\n  }\n  return claimApprovers.map((tm, i) => ({\n    parsed: tm!,\n    pubkey: claimApproverIds[i]!,\n  }));\n};\n\nexport const getAllClaimApprovers = async (\n  connection: Connection\n): Promise<AccountData<PaidClaimApproverData>[]> => {\n  const programAccounts = await connection.getProgramAccounts(\n    CLAIM_APPROVER_ADDRESS\n  );\n\n  const claimApprovers: AccountData<PaidClaimApproverData>[] = [];\n  const coder = new BorshAccountsCoder(CLAIM_APPROVER_IDL);\n  programAccounts.forEach((account) => {\n    try {\n      const claimApproverData: PaidClaimApproverData = coder.decode(\n        \"paidClaimApprover\",\n        account.account.data\n      );\n      claimApprovers.push({\n        ...account,\n        parsed: claimApproverData,\n      });\n    } catch (e) {\n      console.log(`Failed to decode claim approver data`);\n    }\n  });\n  return claimApprovers;\n};\n"]}